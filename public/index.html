<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Canvas App</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.47/vue.global.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="app" class="container mx-auto p-4">
        <div class="flex justify-center">
            <label for="file"> Choose an image</label>
            <input type="file" accept="image/*" @change="onInputFile">
        </div>
        <div v-if="loading" class="m-5 bottom-0 left-0 absolute rounded-lg w-[400px] h-32  bg-[#008bb5] text-[#ffffff]">
            <div class="flex flex-row w-full gap-5 justify-center items-center px-5 w-full h-full">
                <div class="my-auto text-2xl">
                    <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 16v-4"></path>
                        <path d="M12 8h.01"></path>
                    </svg>
                </div>
                <div>
                    <div class="font-bold text-2xl">Check your Inbox!</div>
                    <div class=" text-lg">You have one new unread message in your inbox.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                onInputFile = (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        sendToAPI(file);
                    }
                };
                const loading = ref(false);
                const sendToAPI = async (blob) => {
                    loading.value = true;
                    try {
                        const response = await fetch('/api/print', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/octet-stream',
                            },
                            body: blob,
                        });
                        if (response.ok) {
                            alert('Image sent successfully!');
                        } else {
                            throw new Error('Failed to send image');
                        }
                    } catch (err) {
                        console.error("Error sending image to API:", err);
                        alert('Failed to send image to API');
                    }
                    loading.value = false;
                };

                return {
                    loading,
                    onInputFile,
                    sendToAPI,
                };
            },
        }).mount('#app');
    </script>
</body>
</html>